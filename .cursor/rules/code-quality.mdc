---
globs: lib/**/*.dart,test/**/*.dart
description: Flutter ì½”ë“œ í’ˆì§ˆ ë° ë¦¬íŒ©í„°ë§ ê°€ì´ë“œ
---

# Flutter ì½”ë“œ í’ˆì§ˆ ê°€ì´ë“œ

## ğŸ¯ ì½”ë“œ í’ˆì§ˆ ì›ì¹™

### 1. SOLID ì›ì¹™ ì ìš©

- **S**ingle Responsibility: í´ë˜ìŠ¤ëŠ” í•˜ë‚˜ì˜ ì±…ì„ë§Œ ê°€ì§
- **O**pen/Closed: í™•ì¥ì—ëŠ” ì—´ë ¤ìˆê³  ìˆ˜ì •ì—ëŠ” ë‹«í˜€ìˆìŒ
- **L**iskov Substitution: í•˜ìœ„ íƒ€ì…ì€ ìƒìœ„ íƒ€ì…ì„ ëŒ€ì²´ ê°€ëŠ¥
- **I**nterface Segregation: ì¸í„°í˜ì´ìŠ¤ëŠ” ìµœì†Œí•œì˜ ë©”ì„œë“œë§Œ í¬í•¨
- **D**ependency Inversion: ì¶”ìƒí™”ì— ì˜ì¡´, êµ¬ì²´í™”ì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ

### 2. Clean Code ì›ì¹™

- ì˜ë¯¸ìˆëŠ” ì´ë¦„ ì‚¬ìš©
- ì‘ì€ í•¨ìˆ˜ì™€ í´ë˜ìŠ¤
- ì£¼ì„ë³´ë‹¤ëŠ” ì½”ë“œ ìì²´ê°€ ì„¤ëª…ë ¥ ìˆê²Œ
- ì¤‘ë³µ ì œê±° (DRY: Don't Repeat Yourself)

## ğŸ“ ë„¤ì´ë° ê·œì¹™

### í´ë˜ìŠ¤ëª…

```dart
// âœ… ì¢‹ì€ ì˜ˆ
class UserProfileService {}
class AuthProvider {}
class RunningSession {}

// âŒ ë‚˜ìœ ì˜ˆ
class userProfileService {}
class Auth_Provider {}
class RunningSessionManager {}
```

### ë©”ì„œë“œëª…

```dart
// âœ… ì¢‹ì€ ì˜ˆ
Future<UserProfile> createUserProfile() {}
bool isLoggedIn() {}
void updateProfile() {}

// âŒ ë‚˜ìœ ì˜ˆ
Future<UserProfile> create() {}
bool check() {}
void update() {}
```

### ë³€ìˆ˜ëª…

```dart
// âœ… ì¢‹ì€ ì˜ˆ
final String userEmail;
final bool isAuthenticated;
final List<RunningSession> runningSessions;

// âŒ ë‚˜ìœ ì˜ˆ
final String email;
final bool auth;
final List<RunningSession> sessions;
```

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ íŒ¨í„´

### í˜„ì¬ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
lib/
â”œâ”€â”€ config/          # ì„¤ì • íŒŒì¼
â”œâ”€â”€ constants/       # ìƒìˆ˜ ì •ì˜
â”œâ”€â”€ models/          # ë°ì´í„° ëª¨ë¸
â”œâ”€â”€ services/        # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”œâ”€â”€ providers/       # ìƒíƒœ ê´€ë¦¬
â”œâ”€â”€ screens/         # UI í™”ë©´
â”œâ”€â”€ widgets/         # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ìœ„ì ¯
â””â”€â”€ utils/           # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
```

### ì˜ì¡´ì„± ì£¼ì… íŒ¨í„´

```dart
// âœ… ì¢‹ì€ ì˜ˆ - ì˜ì¡´ì„± ì£¼ì…
class AuthService {
  final SupabaseClient _supabase;

  AuthService(this._supabase);

  Future<AuthResponse> signIn(String email, String password) {
    return _supabase.auth.signInWithPassword(
      email: email,
      password: password,
    );
  }
}

// âŒ ë‚˜ìœ ì˜ˆ - í•˜ë“œì½”ë”©ëœ ì˜ì¡´ì„±
class AuthService {
  Future<AuthResponse> signIn(String email, String password) {
    final supabase = Supabase.instance.client; // í•˜ë“œì½”ë”©
    return supabase.auth.signInWithPassword(
      email: email,
      password: password,
    );
  }
}
```

## ğŸ”„ ë¦¬íŒ©í„°ë§ ê°€ì´ë“œ

### 1. ë©”ì„œë“œ ì¶”ì¶œ (Extract Method)

```dart
// Before
void _handleLogin() {
  if (emailController.text.isEmpty) {
    ScaffoldMessenger.of(context).showSnackBar(
      const SnackBar(content: Text('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”')),
    );
    return;
  }

  if (passwordController.text.isEmpty) {
    ScaffoldMessenger.of(context).showSnackBar(
      const SnackBar(content: Text('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”')),
    );
    return;
  }

  // ë¡œê·¸ì¸ ë¡œì§...
}

// After
void _handleLogin() {
  if (!_validateInputs()) return;
  _performLogin();
}

bool _validateInputs() {
  if (emailController.text.isEmpty) {
    _showError('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
    return false;
  }

  if (passwordController.text.isEmpty) {
    _showError('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
    return false;
  }

  return true;
}

void _showError(String message) {
  ScaffoldMessenger.of(context).showSnackBar(
    SnackBar(content: Text(message)),
  );
}
```

### 2. ìƒìˆ˜ ì¶”ì¶œ (Extract Constant)

```dart
// Before
class LoginScreen extends StatefulWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Padding(
        padding: const EdgeInsets.all(16.0),
        child: Column(
          children: [
            TextField(
              decoration: InputDecoration(
                border: OutlineInputBorder(
                  borderRadius: BorderRadius.circular(8.0),
                ),
              ),
            ),
          ],
        ),
      ),
    );
  }
}

// After
class LoginScreen extends StatefulWidget {
  static const double _defaultPadding = 16.0;
  static const double _borderRadius = 8.0;

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Padding(
        padding: const EdgeInsets.all(_defaultPadding),
        child: Column(
          children: [
            TextField(
              decoration: InputDecoration(
                border: OutlineInputBorder(
                  borderRadius: BorderRadius.circular(_borderRadius),
                ),
              ),
            ),
          ],
        ),
      ),
    );
  }
}
```

### 3. ì¡°ê±´ë¬¸ ë‹¨ìˆœí™”

```dart
// Before
String getFitnessLevelText(FitnessLevel level) {
  if (level == FitnessLevel.beginner) {
    return 'ì´ˆê¸‰';
  } else if (level == FitnessLevel.intermediate) {
    return 'ì¤‘ê¸‰';
  } else if (level == FitnessLevel.advanced) {
    return 'ê³ ê¸‰';
  } else {
    return 'ì•Œ ìˆ˜ ì—†ìŒ';
  }
}

// After
String getFitnessLevelText(FitnessLevel level) {
  return switch (level) {
    FitnessLevel.beginner => 'ì´ˆê¸‰',
    FitnessLevel.intermediate => 'ì¤‘ê¸‰',
    FitnessLevel.advanced => 'ê³ ê¸‰',
  };
}
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ì½”ë“œ ì‘ì„±

### 1. ìˆœìˆ˜ í•¨ìˆ˜ ì‘ì„±

```dart
// âœ… ì¢‹ì€ ì˜ˆ - ìˆœìˆ˜ í•¨ìˆ˜
double calculateBMI(double height, double weight) {
  if (height <= 0 || weight <= 0) {
    throw ArgumentError('Height and weight must be positive');
  }
  return weight / ((height / 100) * (height / 100));
}

// âŒ ë‚˜ìœ ì˜ˆ - ë¶€ì‘ìš©ì´ ìˆëŠ” í•¨ìˆ˜
double calculateBMI(double height, double weight) {
  if (height <= 0 || weight <= 0) {
    print('Invalid input'); // ë¶€ì‘ìš©
    return -1; // ì˜ˆì™¸ ìƒí™©ì„ -1ë¡œ í‘œí˜„
  }
  return weight / ((height / 100) * (height / 100));
}
```

### 2. ì˜ì¡´ì„± ì£¼ì…ì„ í†µí•œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ì„±

```dart
// âœ… ì¢‹ì€ ì˜ˆ
class UserProfileService {
  final SupabaseClient _supabase;

  UserProfileService(this._supabase);

  Future<UserProfile?> getCurrentUserProfile() async {
    final user = _supabase.auth.currentUser;
    if (user == null) return null;

    final response = await _supabase
        .from('user_profiles')
        .select()
        .eq('id', user.id)
        .single();

    return UserProfile.fromJson(response);
  }
}

// í…ŒìŠ¤íŠ¸ì—ì„œ Mock ì£¼ì… ê°€ëŠ¥
void main() {
  test('should return null when user is not authenticated', () {
    final mockSupabase = MockSupabaseClient();
    final service = UserProfileService(mockSupabase);

    when(mockSupabase.auth.currentUser).thenReturn(null);

    final result = service.getCurrentUserProfile();

    expect(result, completion(isNull));
  });
}
```

## ğŸ“Š ì½”ë“œ ë©”íŠ¸ë¦­ìŠ¤

### ë³µì¡ë„ ê´€ë¦¬

- **ìˆœí™˜ ë³µì¡ë„**: 10 ì´í•˜ ìœ ì§€
- **í•¨ìˆ˜ ê¸¸ì´**: 20ì¤„ ì´í•˜ ê¶Œì¥
- **í´ë˜ìŠ¤ ê¸¸ì´**: 200ì¤„ ì´í•˜ ê¶Œì¥
- **ë§¤ê°œë³€ìˆ˜ ê°œìˆ˜**: 3ê°œ ì´í•˜ ê¶Œì¥

### ì¤‘ë³µ ì½”ë“œ ì œê±°

```dart
// Before - ì¤‘ë³µ ì½”ë“œ
class LoginScreen extends StatefulWidget {
  void _showError(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text(message)),
    );
  }
}

class SignupScreen extends StatefulWidget {
  void _showError(String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text(message)),
    );
  }
}

// After - ê³µí†µ ìœ í‹¸ë¦¬í‹°
class SnackBarUtils {
  static void showError(BuildContext context, String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text(message)),
    );
  }
}
```

## ğŸ” ì½”ë“œ ë¦¬ë·° ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê¸°ëŠ¥ì  ì¸¡ë©´

- [ ] ìš”êµ¬ì‚¬í•­ì„ ì •í™•íˆ êµ¬í˜„í–ˆëŠ”ê°€?
- [ ] ì˜ˆì™¸ ìƒí™©ì„ ì ì ˆíˆ ì²˜ë¦¬í–ˆëŠ”ê°€?
- [ ] ì„±ëŠ¥ìƒ ë¬¸ì œê°€ ì—†ëŠ”ê°€?

### êµ¬ì¡°ì  ì¸¡ë©´

- [ ] ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ì§€ì¼°ëŠ”ê°€?
- [ ] ì¤‘ë³µ ì½”ë“œê°€ ì—†ëŠ”ê°€?
- [ ] ë„¤ì´ë°ì´ ëª…í™•í•œê°€?

### í…ŒìŠ¤íŠ¸ ì¸¡ë©´

- [ ] í…ŒìŠ¤íŠ¸ê°€ ì¶©ë¶„í•œê°€?
- [ ] í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨ ê°€ëŠ¥í•œê°€?
- [ ] ê²½ê³„ê°’ í…ŒìŠ¤íŠ¸ê°€ ìˆëŠ”ê°€?

### ë³´ì•ˆ ì¸¡ë©´

- [ ] ë¯¼ê°í•œ ì •ë³´ê°€ í•˜ë“œì½”ë”©ë˜ì§€ ì•Šì•˜ëŠ”ê°€?
- [ ] ì…ë ¥ê°’ ê²€ì¦ì´ ì ì ˆí•œê°€?
- [ ] ê¶Œí•œ ì²´í¬ê°€ ìˆëŠ”ê°€?

## ğŸš€ ë¦¬íŒ©í„°ë§ ìš°ì„ ìˆœìœ„

### í˜„ì¬ í”„ë¡œì íŠ¸ ë¦¬íŒ©í„°ë§ ëŒ€ìƒ

1. **AuthService**: ì˜ì¡´ì„± ì£¼ì… ì ìš©
2. **UserProfileService**: ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 
3. **GoogleAuthService**: ì¤‘ë³µ ì½”ë“œ ì œê±°
4. **ProfileScreen**: ìœ„ì ¯ ë¶„ë¦¬
5. **ìƒìˆ˜ ê´€ë¦¬**: í•˜ë“œì½”ë”©ëœ ê°’ë“¤ ìƒìˆ˜ë¡œ ì¶”ì¶œ
