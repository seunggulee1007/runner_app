---
globs: test/**/*.dart,lib/**/*.dart
description: Flutter í…ŒìŠ¤íŠ¸ ì‘ì„± ë° êµ¬ì¡° ê°€ì´ë“œ
---

# Flutter í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

## ğŸ§ª í…ŒìŠ¤íŠ¸ êµ¬ì¡°

### í…ŒìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
test/
â”œâ”€â”€ unit/                    # ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ services/           # ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ models/             # ëª¨ë¸ í´ë˜ìŠ¤ í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ providers/          # Provider í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ utils/              # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ widget/                 # ìœ„ì ¯ í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ screens/            # í™”ë©´ ìœ„ì ¯ í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ components/         # ì»´í¬ë„ŒíŠ¸ ìœ„ì ¯ í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ forms/              # í¼ ìœ„ì ¯ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ integration/            # í†µí•© í…ŒìŠ¤íŠ¸
â””â”€â”€ helpers/                # í…ŒìŠ¤íŠ¸ í—¬í¼
    â”œâ”€â”€ test_data.dart      # í…ŒìŠ¤íŠ¸ ë°ì´í„°
    â”œâ”€â”€ mock_services.dart  # Mock ì„œë¹„ìŠ¤
    â””â”€â”€ test_utils.dart     # í…ŒìŠ¤íŠ¸ ìœ í‹¸ë¦¬í‹°
```

## ğŸ“ í…ŒìŠ¤íŠ¸ ì‘ì„± ê·œì¹™

### 1. í…ŒìŠ¤íŠ¸ íŒŒì¼ ëª…ëª… ê·œì¹™

- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸: `{í´ë˜ìŠ¤ëª…}_test.dart`
- ìœ„ì ¯ í…ŒìŠ¤íŠ¸: `{ìœ„ì ¯ëª…}_test.dart`
- í†µí•© í…ŒìŠ¤íŠ¸: `{ê¸°ëŠ¥ëª…}_integration_test.dart`

### 2. í…ŒìŠ¤íŠ¸ ê·¸ë£¹í™”

```dart
void main() {
  group('AuthService', () {
    group('signInWithEmail', () {
      test('should return AuthResponse when valid credentials', () {
        // í…ŒìŠ¤íŠ¸ ì½”ë“œ
      });

      test('should throw exception when invalid credentials', () {
        // í…ŒìŠ¤íŠ¸ ì½”ë“œ
      });
    });
  });
}
```

### 3. AAA íŒ¨í„´ ì ìš©

```dart
test('should create user profile when valid data provided', () {
  // Arrange - í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¤€ë¹„
  const email = 'test@example.com';
  const displayName = 'Test User';

  // Act - í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ì‹¤í–‰
  final result = UserProfileService.createUserProfile(
    email: email,
    displayName: displayName,
  );

  // Assert - ê²°ê³¼ ê²€ì¦
  expect(result, isA<UserProfile>());
  expect(result.email, equals(email));
});
```

## ğŸ”§ Mock ë° Test Double ì‚¬ìš©

### Mockito ì‚¬ìš© ì˜ˆì‹œ

```dart
// test/helpers/mock_services.dart
import 'package:mockito/mockito.dart';
import 'package:supabase_flutter/supabase_flutter.dart';

class MockSupabaseClient extends Mock implements SupabaseClient {}
class MockAuthClient extends Mock implements GoTrueClient {}
class MockUser extends Mock implements User {}

// í…ŒìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©
void main() {
  late MockSupabaseClient mockSupabase;
  late MockAuthClient mockAuth;

  setUp(() {
    mockSupabase = MockSupabaseClient();
    mockAuth = MockAuthClient();
    when(mockSupabase.auth).thenReturn(mockAuth);
  });
}
```

### Fake ì‚¬ìš© ì˜ˆì‹œ

```dart
// test/helpers/test_data.dart
import 'package:fake_async/fake_async.dart';
import 'package:stride_note/models/user_profile.dart';

class FakeUserProfile extends Fake implements UserProfile {
  @override
  String get id => 'fake-id';

  @override
  String get email => 'fake@example.com';

  @override
  String? get displayName => 'Fake User';
}
```

## ğŸ¯ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„± ê°€ì´ë“œ

### 1. Happy Path í…ŒìŠ¤íŠ¸

```dart
test('should return user profile when valid user ID provided', () {
  // ì •ìƒì ì¸ ì…ë ¥ì— ëŒ€í•œ ì˜ˆìƒ ê²°ê³¼ í…ŒìŠ¤íŠ¸
});
```

### 2. Edge Case í…ŒìŠ¤íŠ¸

```dart
test('should return null when user ID is empty', () {
  // ê²½ê³„ê°’ í…ŒìŠ¤íŠ¸
});

test('should handle network timeout gracefully', () {
  // ì˜ˆì™¸ ìƒí™© í…ŒìŠ¤íŠ¸
});
```

### 3. Error Case í…ŒìŠ¤íŠ¸

```dart
test('should throw AuthException when invalid credentials', () {
  // ì—ëŸ¬ ìƒí™© í…ŒìŠ¤íŠ¸
});
```

## ğŸ–¥ï¸ ìœ„ì ¯ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

### ìœ„ì ¯ í…ŒìŠ¤íŠ¸ ê¸°ë³¸ êµ¬ì¡°

```dart
// test/widget/screens/login_screen_test.dart
import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:provider/provider.dart';
import 'package:stride_note/screens/auth/login_screen.dart';
import 'package:stride_note/providers/auth_provider.dart';

void main() {
  group('LoginScreen', () {
    testWidgets('should display email and password fields', (tester) async {
      // Arrange
      await tester.pumpWidget(
        ChangeNotifierProvider(
          create: (_) => AuthProvider(),
          child: const MaterialApp(
            home: LoginScreen(),
          ),
        ),
      );

      // Act & Assert
      expect(find.byType(TextField), findsNWidgets(2));
      expect(find.text('ì´ë©”ì¼'), findsOneWidget);
      expect(find.text('ë¹„ë°€ë²ˆí˜¸'), findsOneWidget);
    });
  });
}
```

### ì‚¬ìš©ì ìƒí˜¸ì‘ìš© í…ŒìŠ¤íŠ¸

```dart
testWidgets('should show error message when login fails', (tester) async {
  // Arrange
  await tester.pumpWidget(/* ìœ„ì ¯ ì„¤ì • */);

  // Act
  await tester.enterText(find.byKey(const Key('email_field')), 'invalid@email.com');
  await tester.enterText(find.byKey(const Key('password_field')), 'wrongpassword');
  await tester.tap(find.byKey(const Key('login_button')));
  await tester.pump();

  // Assert
  expect(find.text('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤'), findsOneWidget);
});
```

## ğŸ”„ í†µí•© í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

### í†µí•© í…ŒìŠ¤íŠ¸ ê¸°ë³¸ êµ¬ì¡°

```dart
// integration_test/app_test.dart
import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:integration_test/integration_test.dart';
import 'package:stride_note/main.dart' as app;

void main() {
  IntegrationTestWidgetsFlutterBinding.ensureInitialized();

  group('App Integration Tests', () {
    testWidgets('should complete login flow', (tester) async {
      // Arrange
      app.main();
      await tester.pumpAndSettle();

      // Act
      await tester.tap(find.text('ë¡œê·¸ì¸'));
      await tester.pumpAndSettle();

      // Assert
      expect(find.text('í™ˆ í™”ë©´'), findsOneWidget);
    });
  });
}
```

## ğŸ“Š í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë° ì»¤ë²„ë¦¬ì§€

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ëª…ë ¹ì–´

```bash
# ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰
flutter test

# íŠ¹ì • ë””ë ‰í† ë¦¬ í…ŒìŠ¤íŠ¸
flutter test test/unit/

# ì»¤ë²„ë¦¬ì§€ í¬í•¨ í…ŒìŠ¤íŠ¸
flutter test --coverage

# íŠ¹ì • í…ŒìŠ¤íŠ¸ íŒŒì¼ ì‹¤í–‰
flutter test test/unit/services/auth_service_test.dart

# í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰
flutter test integration_test/
```

### ì»¤ë²„ë¦¬ì§€ í™•ì¸

```bash
# ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ ìƒì„±
flutter test --coverage
genhtml coverage/lcov.info -o coverage/html
open coverage/html/index.html
```

## ğŸš¨ í˜„ì¬ í”„ë¡œì íŠ¸ í…ŒìŠ¤íŠ¸ ìš°ì„ ìˆœìœ„

### 1. í•µì‹¬ ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸

- [ ] `AuthService` í…ŒìŠ¤íŠ¸
- [ ] `UserProfileService` í…ŒìŠ¤íŠ¸
- [ ] `GoogleAuthService` í…ŒìŠ¤íŠ¸

### 2. ëª¨ë¸ í…ŒìŠ¤íŠ¸

- [ ] `UserProfile` ëª¨ë¸ í…ŒìŠ¤íŠ¸
- [ ] JSON ì§ë ¬í™”/ì—­ì§ë ¬í™” í…ŒìŠ¤íŠ¸

### 3. ìœ„ì ¯ í…ŒìŠ¤íŠ¸

- [ ] `LoginScreen` í…ŒìŠ¤íŠ¸
- [ ] `ProfileScreen` í…ŒìŠ¤íŠ¸
- [ ] `SignupScreen` í…ŒìŠ¤íŠ¸

### 4. í†µí•© í…ŒìŠ¤íŠ¸

- [ ] ì¸ì¦ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
- [ ] í”„ë¡œí•„ ê´€ë¦¬ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
