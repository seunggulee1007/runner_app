# ğŸ—ï¸ StrideNote ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

## ëª©ì°¨

- [ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°](#ì „ì²´-ì‹œìŠ¤í…œ-êµ¬ì¡°)
- [ë ˆì´ì–´ ì•„í‚¤í…ì²˜](#ë ˆì´ì–´-ì•„í‚¤í…ì²˜)
- [ë°ì´í„° í”Œë¡œìš°](#ë°ì´í„°-í”Œë¡œìš°)
- [í”„ë¡œì íŠ¸ êµ¬ì¡°](#í”„ë¡œì íŠ¸-êµ¬ì¡°)
- [ë””ìì¸ íŒ¨í„´](#ë””ìì¸-íŒ¨í„´)
- [ìƒíƒœ ê´€ë¦¬](#ìƒíƒœ-ê´€ë¦¬)
- [ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„](#ë°ì´í„°ë² ì´ìŠ¤-ì„¤ê³„)

---

## ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Flutter App (Client)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Screens  â”‚  â”‚ Widgets  â”‚  â”‚  Providers        â”‚      â”‚
â”‚  â”‚  (View)   â”‚  â”‚ (UI)     â”‚  â”‚  (State Mgmt)     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚        â”‚             â”‚                   â”‚                â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                      â”‚                                    â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚              â”‚    Services    â”‚  â† Business Logic         â”‚
â”‚              â”‚  (Service Layer)â”‚                          â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                      â”‚                                    â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚         â”‚            â”‚            â”‚                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”                   â”‚
â”‚    â”‚ Models â”‚   â”‚ Utils â”‚   â”‚ Config â”‚                   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚              â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
   â”‚Supabase â”‚   â”‚Google APIsâ”‚  â”‚HealthKit â”‚
   â”‚(Backend)â”‚   â”‚ - Maps    â”‚  â”‚/GoogleFitâ”‚
   â”‚         â”‚   â”‚ - Sign-In â”‚  â”‚          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### êµ¬ì„± ìš”ì†Œ

#### 1. Flutter App (Client)

- **View Layer**: ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤
- **Provider Layer**: ìƒíƒœ ê´€ë¦¬
- **Service Layer**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
- **Model Layer**: ë°ì´í„° ëª¨ë¸

#### 2. Backend Services

- **Supabase**: ì¸ì¦, ë°ì´í„°ë² ì´ìŠ¤, ì‹¤ì‹œê°„ í†µì‹ 
- **Google APIs**: ì§€ë„, ì†Œì…œ ë¡œê·¸ì¸
- **HealthKit/Google Fit**: ê±´ê°• ë°ì´í„°

---

## ë ˆì´ì–´ ì•„í‚¤í…ì²˜

### Service-Provider-View íŒ¨í„´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   View Layer (Screens/Widgets)     â”‚
â”‚   - HomeScreen                      â”‚  â† UI ë Œë”ë§
â”‚   - RunningScreen                   â”‚  â† ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬
â”‚   - ProfileScreen                   â”‚  â† í™”ë©´ ì „í™˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ listens to (Consumer/Selector)
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Provider Layer (State Management) â”‚
â”‚   - AuthProvider                    â”‚  â† ìƒíƒœ ê´€ë¦¬
â”‚   - (LocationProvider - ê³„íš ì¤‘)    â”‚  â† ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¡°ìœ¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ calls
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Service Layer (Business Logic)   â”‚
â”‚   - AuthService                     â”‚  â† API í˜¸ì¶œ
â”‚   - LocationService                 â”‚  â† ë°ì´í„° ì²˜ë¦¬
â”‚   - HealthService                   â”‚  â† ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™
â”‚   - DatabaseService                 â”‚
â”‚   - GoogleAuthService               â”‚
â”‚   - UserProfileService              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ uses
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Model Layer (Data Models)        â”‚
â”‚   - UserProfile                     â”‚  â† ë°ì´í„° êµ¬ì¡° ì •ì˜
â”‚   - RunningSession                  â”‚  â† JSON ì§ë ¬í™”/ì—­ì§ë ¬í™”
â”‚   - GPSPoint                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê° ë ˆì´ì–´ì˜ ì—­í• 

#### View Layer

**ì±…ì„**: UI ë Œë”ë§, ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬, í™”ë©´ ì „í™˜

```dart
// ì˜ˆì‹œ: HomeScreen
class HomeScreen extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Consumer<AuthProvider>(
      builder: (context, authProvider, child) {
        // Providerì˜ ìƒíƒœë¥¼ êµ¬ë…í•˜ì—¬ UI ì—…ë°ì´íŠ¸
        final user = authProvider.currentUser;

        return Scaffold(
          body: user != null
            ? HomeContent(user: user)
            : LoginPrompt(),
        );
      },
    );
  }
}
```

**ê·œì¹™**:

- âœ… Providerë¥¼ í†µí•´ì„œë§Œ ìƒíƒœ ì ‘ê·¼
- âœ… Serviceë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
- âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í¬í•¨í•˜ì§€ ì•ŠìŒ

---

#### Provider Layer

**ì±…ì„**: ìƒíƒœ ê´€ë¦¬, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¡°ìœ¨, ë¦¬ìŠ¤ë„ˆ ì•Œë¦¼

```dart
// ì˜ˆì‹œ: AuthProvider
class AuthProvider extends ChangeNotifier {
  User? _currentUser;
  bool _isLoading = false;

  // Getter
  User? get currentUser => _currentUser;
  bool get isLoading => _isLoading;

  // ë¡œê·¸ì¸ (Service í˜¸ì¶œ)
  Future<void> signIn(String email, String password) async {
    _isLoading = true;
    notifyListeners();

    try {
      final user = await AuthService.signInWithEmail(
        email: email,
        password: password,
      );
      _currentUser = user;
    } catch (e) {
      rethrow;
    } finally {
      _isLoading = false;
      notifyListeners();
    }
  }
}
```

**ê·œì¹™**:

- âœ… ChangeNotifier ìƒì†
- âœ… Service Layer í˜¸ì¶œ
- âœ… ìƒíƒœ ë³€ê²½ ì‹œ notifyListeners() í˜¸ì¶œ
- âœ… ë¹„ê³µê°œ ë³€ìˆ˜ + public getter

---

#### Service Layer

**ì±…ì„**: API í†µì‹ , ë°ì´í„° ì²˜ë¦¬, ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™

```dart
// ì˜ˆì‹œ: AuthService
class AuthService {
  static final SupabaseClient _supabase = Supabase.instance.client;

  /// ì´ë©”ì¼ ë¡œê·¸ì¸
  static Future<User?> signInWithEmail({
    required String email,
    required String password,
  }) async {
    try {
      final response = await _supabase.auth.signInWithPassword(
        email: email,
        password: password,
      );
      return response.user;
    } on AuthException catch (e) {
      throw Exception('ë¡œê·¸ì¸ ì‹¤íŒ¨: ${e.message}');
    }
  }

  /// ë¡œê·¸ì•„ì›ƒ
  static Future<void> signOut() async {
    await _supabase.auth.signOut();
  }
}
```

**ê·œì¹™**:

- âœ… static ë©”ì„œë“œ ì‚¬ìš© (ìƒíƒœ ì—†ìŒ)
- âœ… ìˆœìˆ˜ í•¨ìˆ˜ë¡œ êµ¬í˜„ (ë¶€ì‘ìš© ìµœì†Œí™”)
- âœ… ì—ëŸ¬ í•¸ë“¤ë§ í¬í•¨
- âœ… Model ê°ì²´ ë°˜í™˜

---

#### Model Layer

**ì±…ì„**: ë°ì´í„° êµ¬ì¡° ì •ì˜, JSON ì§ë ¬í™”/ì—­ì§ë ¬í™”

```dart
// ì˜ˆì‹œ: UserProfile
@JsonSerializable()
class UserProfile {
  final String id;
  final String email;
  final String? displayName;
  final String? avatarUrl;
  final String fitnessLevel;
  final DateTime createdAt;
  final DateTime updatedAt;

  UserProfile({
    required this.id,
    required this.email,
    this.displayName,
    this.avatarUrl,
    required this.fitnessLevel,
    required this.createdAt,
    required this.updatedAt,
  });

  // JSON ì§ë ¬í™”
  factory UserProfile.fromJson(Map<String, dynamic> json) =>
      _$UserProfileFromJson(json);

  Map<String, dynamic> toJson() => _$UserProfileToJson(this);
}
```

**ê·œì¹™**:

- âœ… ë¶ˆë³€ ê°ì²´ (final í•„ë“œ)
- âœ… @JsonSerializable ì–´ë…¸í…Œì´ì…˜
- âœ… fromJson / toJson ë©”ì„œë“œ
- âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í¬í•¨í•˜ì§€ ì•ŠìŒ

---

## ë°ì´í„° í”Œë¡œìš°

### ì‚¬ìš©ì ì•¡ì…˜ â†’ UI ì—…ë°ì´íŠ¸ í”Œë¡œìš°

```
1. ì‚¬ìš©ì ì•¡ì…˜ (User Action)
   ì˜ˆ: ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­
   â†“
2. View Layer - ì´ë²¤íŠ¸ ìˆ˜ì‹ 
   ì˜ˆ: onPressed: () => authProvider.signIn(email, password)
   â†“
3. Provider Layer - ìƒíƒœ ë³€ê²½ ì‹œì‘
   ì˜ˆ: _isLoading = true; notifyListeners();
   â†“
4. Service Layer - API í˜¸ì¶œ
   ì˜ˆ: AuthService.signInWithEmail(...)
   â†“
5. External Services - ì›ê²© ìš”ì²­
   ì˜ˆ: Supabase API í˜¸ì¶œ
   â†“
6. Service Layer - ì‘ë‹µ ìˆ˜ì‹ 
   ì˜ˆ: return response.user;
   â†“
7. Model Layer - ë°ì´í„° ë³€í™˜
   ì˜ˆ: User.fromJson(json)
   â†“
8. Provider Layer - ìƒíƒœ ì—…ë°ì´íŠ¸
   ì˜ˆ: _currentUser = user; notifyListeners();
   â†“
9. View Layer - UI ìë™ ì¬ë Œë”ë§
   ì˜ˆ: Consumerê°€ rebuild íŠ¸ë¦¬ê±°
   â†“
10. ì‚¬ìš©ìì—ê²Œ ê²°ê³¼ í‘œì‹œ
    ì˜ˆ: í™ˆ í™”ë©´ìœ¼ë¡œ ì´ë™
```

### ì‹¤ì‹œê°„ ë°ì´í„° ìŠ¤íŠ¸ë¦¼ í”Œë¡œìš°

```
1. Service Layer - ìŠ¤íŠ¸ë¦¼ êµ¬ë…
   ì˜ˆ: Geolocator.getPositionStream()
   â†“
2. Service Layer - ë°ì´í„° ìˆ˜ì‹ 
   ì˜ˆ: Position ê°ì²´ ìˆ˜ì‹ 
   â†“
3. Service Layer - ë°ì´í„° ì²˜ë¦¬
   ì˜ˆ: ê±°ë¦¬ ê³„ì‚°, ë²„í¼ë§
   â†“
4. Provider Layer - ìƒíƒœ ì—…ë°ì´íŠ¸
   ì˜ˆ: _totalDistance += distance; notifyListeners();
   â†“
5. View Layer - UI ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
   ì˜ˆ: ëŸ¬ë‹ í†µê³„ í™”ë©´ ê°±ì‹ 
```

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°

### ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
lib/
â”œâ”€â”€ config/                     # ì•± ì„¤ì • ë° í™˜ê²½ ë³€ìˆ˜
â”‚   â”œâ”€â”€ app_config.dart          # í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬ (.env)
â”‚   â””â”€â”€ supabase_config.dart     # Supabase ì´ˆê¸°í™”
â”‚
â”œâ”€â”€ constants/                  # ì•± ì „ì—­ ìƒìˆ˜
â”‚   â”œâ”€â”€ app_colors.dart          # ì»¬ëŸ¬ íŒ”ë ˆíŠ¸
â”‚   â””â”€â”€ app_theme.dart           # Material í…Œë§ˆ
â”‚
â”œâ”€â”€ models/                     # ë°ì´í„° ëª¨ë¸
â”‚   â”œâ”€â”€ user_profile.dart        # ì‚¬ìš©ì í”„ë¡œí•„
â”‚   â”œâ”€â”€ user_profile.g.dart      # JSON ì§ë ¬í™” (ìë™ ìƒì„±)
â”‚   â”œâ”€â”€ running_session.dart     # ëŸ¬ë‹ ì„¸ì…˜
â”‚   â””â”€â”€ running_session.g.dart
â”‚
â”œâ”€â”€ services/                   # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”œâ”€â”€ auth_service.dart           # ì¸ì¦
â”‚   â”œâ”€â”€ google_auth_service.dart    # Google ë¡œê·¸ì¸
â”‚   â”œâ”€â”€ user_profile_service.dart   # í”„ë¡œí•„ ê´€ë¦¬
â”‚   â”œâ”€â”€ location_service.dart       # GPS ì¶”ì 
â”‚   â”œâ”€â”€ health_service.dart         # ê±´ê°• ë°ì´í„°
â”‚   â”œâ”€â”€ database_service.dart       # ë¡œì»¬ DB
â”‚   â””â”€â”€ supabase_oauth_validator.dart
â”‚
â”œâ”€â”€ providers/                  # ìƒíƒœ ê´€ë¦¬
â”‚   â””â”€â”€ auth_provider.dart       # ì¸ì¦ ìƒíƒœ
â”‚
â”œâ”€â”€ screens/                    # UI í™”ë©´
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ login_screen.dart
â”‚   â”‚   â””â”€â”€ signup_screen.dart
â”‚   â”œâ”€â”€ home_screen.dart
â”‚   â”œâ”€â”€ running_screen.dart
â”‚   â”œâ”€â”€ history_screen.dart
â”‚   â”œâ”€â”€ profile_screen.dart
â”‚   â””â”€â”€ splash_screen.dart
â”‚
â”œâ”€â”€ widgets/                    # ì¬ì‚¬ìš© ìœ„ì ¯
â”‚   â”œâ”€â”€ running_card.dart
â”‚   â”œâ”€â”€ running_timer.dart
â”‚   â”œâ”€â”€ running_stats.dart
â”‚   â”œâ”€â”€ running_controls.dart
â”‚   â”œâ”€â”€ running_map.dart
â”‚   â”œâ”€â”€ stats_summary.dart
â”‚   â””â”€â”€ quick_actions.dart
â”‚
â”œâ”€â”€ types/                      # íƒ€ì… ì •ì˜
â”‚   â””â”€â”€ supabase_types.dart
â”‚
â””â”€â”€ main.dart                   # ì•± ì§„ì…ì 

test/                           # í…ŒìŠ¤íŠ¸
â”œâ”€â”€ unit/                       # ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ models/
â”‚   â””â”€â”€ providers/
â”œâ”€â”€ widget/                     # ìœ„ì ¯ í…ŒìŠ¤íŠ¸
â””â”€â”€ integration/                # í†µí•© í…ŒìŠ¤íŠ¸
```

### íŒŒì¼ ëª…ëª… ê·œì¹™

```
íŒŒì¼ëª…: snake_case
â”œâ”€ user_profile.dart âœ…
â””â”€ UserProfile.dart âŒ

í´ë˜ìŠ¤ëª…: PascalCase
â”œâ”€ class UserProfile âœ…
â””â”€ class user_profile âŒ

ë³€ìˆ˜/í•¨ìˆ˜: camelCase
â”œâ”€ final userName âœ…
â”œâ”€ void getUserProfile() âœ…
â””â”€ final user_name âŒ

ìƒìˆ˜: lowerCamelCase (Dart ìŠ¤íƒ€ì¼)
â”œâ”€ const defaultPadding = 16.0; âœ…
â””â”€ const DEFAULT_PADDING = 16.0; âŒ
```

---

## ë””ìì¸ íŒ¨í„´

### 1. Provider íŒ¨í„´ (ìƒíƒœ ê´€ë¦¬)

```dart
// main.dart - Provider ë“±ë¡
MultiProvider(
  providers: [
    ChangeNotifierProvider(create: (_) => AuthProvider()),
    Provider(create: (_) => LocationService()),
    Provider(create: (_) => DatabaseService()),
  ],
  child: MaterialApp(...),
)

// í™”ë©´ì—ì„œ ì‚¬ìš©
// ë°©ë²• 1: Consumer (ì „ì²´ ìœ„ì ¯ ë¦¬ë¹Œë“œ)
Consumer<AuthProvider>(
  builder: (context, authProvider, child) {
    return Text(authProvider.currentUser?.email ?? '');
  },
)

// ë°©ë²• 2: Selector (íŠ¹ì • ì†ì„±ë§Œ êµ¬ë…)
Selector<AuthProvider, String?>(
  selector: (_, provider) => provider.currentUser?.email,
  builder: (_, email, __) => Text(email ?? ''),
)

// ë°©ë²• 3: Provider.of (ë¦¬ë¹Œë“œ ì—†ì´ ë©”ì„œë“œ í˜¸ì¶œ)
final authProvider = Provider.of<AuthProvider>(
  context,
  listen: false,
);
authProvider.signIn(email, password);
```

**ì¥ì **:

- âœ… ê°„ë‹¨í•˜ê³  ì§ê´€ì 
- âœ… Flutter ê³µì‹ ì¶”ì²œ
- âœ… ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì ìŒ
- âœ… í…ŒìŠ¤íŠ¸ ìš©ì´

---

### 2. Singleton íŒ¨í„´

```dart
// ì˜ˆì‹œ: LocationService
class LocationService {
  // Private ìƒì„±ì
  LocationService._internal();

  // Static ì¸ìŠ¤í„´ìŠ¤
  static final LocationService _instance = LocationService._internal();

  // Factory ìƒì„±ì
  factory LocationService() {
    return _instance;
  }

  // ... ë©”ì„œë“œ
}

// ì‚¬ìš©
final service1 = LocationService();
final service2 = LocationService();
print(service1 == service2); // true (ë™ì¼í•œ ì¸ìŠ¤í„´ìŠ¤)
```

**ì¥ì **:

- âœ… ì „ì—­ ìƒíƒœ ê´€ë¦¬
- âœ… ë¦¬ì†ŒìŠ¤ ê³µìœ  (GPS, ë°ì´í„°ë² ì´ìŠ¤)
- âœ… ë©”ëª¨ë¦¬ íš¨ìœ¨ì 

---

### 3. Factory íŒ¨í„´

```dart
// ì˜ˆì‹œ: RunningSession
class RunningSession {
  final RunningType type;

  // Factory ìƒì„±ì
  factory RunningSession.fromJson(Map<String, dynamic> json) {
    return RunningSession(
      type: RunningType.values.firstWhere(
        (e) => e.name == json['type'],
      ),
      // ...
    );
  }

  // Named constructor
  RunningSession.free({
    required this.startTime,
    required this.endTime,
  }) : type = RunningType.free;

  RunningSession.interval({
    required this.startTime,
    required this.endTime,
  }) : type = RunningType.interval;
}
```

---

### 4. Stream íŒ¨í„´ (ë°˜ì‘í˜• í”„ë¡œê·¸ë˜ë°)

```dart
// ì˜ˆì‹œ: LocationService
class LocationService {
  final StreamController<Position> _positionController =
      StreamController<Position>.broadcast();

  // Stream ë…¸ì¶œ
  Stream<Position> get positionStream => _positionController.stream;

  // ë°ì´í„° ì¶”ê°€
  void _onPositionReceived(Position position) {
    _positionController.add(position);
  }

  // ë¦¬ì†ŒìŠ¤ ì •ë¦¬
  void dispose() {
    _positionController.close();
  }
}

// ì‚¬ìš©
locationService.positionStream.listen((position) {
  print('ìœ„ì¹˜: ${position.latitude}, ${position.longitude}');
});
```

---

## ìƒíƒœ ê´€ë¦¬

### Provider íŒ¨í„´ ìƒì„¸

#### 1. ChangeNotifier êµ¬í˜„

```dart
class AuthProvider extends ChangeNotifier {
  // Private ìƒíƒœ
  User? _currentUser;
  bool _isLoading = false;
  String? _errorMessage;

  // Public getter
  User? get currentUser => _currentUser;
  bool get isLoading => _isLoading;
  String? get errorMessage => _errorMessage;
  bool get isAuthenticated => _currentUser != null;

  // ì´ˆê¸°í™”
  Future<void> initialize() async {
    _currentUser = Supabase.instance.client.auth.currentUser;
    notifyListeners();
  }

  // ë¡œê·¸ì¸
  Future<void> signIn(String email, String password) async {
    try {
      _isLoading = true;
      _errorMessage = null;
      notifyListeners();

      final user = await AuthService.signInWithEmail(
        email: email,
        password: password,
      );

      _currentUser = user;
    } catch (e) {
      _errorMessage = e.toString();
      rethrow;
    } finally {
      _isLoading = false;
      notifyListeners();
    }
  }

  // ë¡œê·¸ì•„ì›ƒ
  Future<void> signOut() async {
    await AuthService.signOut();
    _currentUser = null;
    notifyListeners();
  }
}
```

#### 2. Consumer vs Selector

```dart
// Consumer: ì „ì²´ Providerê°€ ë³€ê²½ë˜ë©´ ë¦¬ë¹Œë“œ
Consumer<AuthProvider>(
  builder: (context, authProvider, child) {
    // authProviderì˜ ì–´ë–¤ ì†ì„±ì´ ë³€ê²½ë˜ì–´ë„ ë¦¬ë¹Œë“œ
    return Text(authProvider.currentUser?.email ?? 'ë¡œê·¸ì¸ í•„ìš”');
  },
)

// Selector: íŠ¹ì • ì†ì„±ë§Œ êµ¬ë…
Selector<AuthProvider, String?>(
  selector: (_, provider) => provider.currentUser?.email,
  builder: (_, email, __) {
    // emailì´ ë³€ê²½ë  ë•Œë§Œ ë¦¬ë¹Œë“œ
    return Text(email ?? 'ë¡œê·¸ì¸ í•„ìš”');
  },
)
```

**ì„±ëŠ¥ ë¹„êµ**:

- Consumer: ê°„ë‹¨í•˜ì§€ë§Œ ë¶ˆí•„ìš”í•œ ë¦¬ë¹Œë“œ ë°œìƒ ê°€ëŠ¥
- Selector: ë³µì¡í•˜ì§€ë§Œ ìµœì í™”ëœ ë¦¬ë¹Œë“œ

---

## ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### Supabase (PostgreSQL) ìŠ¤í‚¤ë§ˆ

#### 1. user_profiles í…Œì´ë¸”

```sql
CREATE TABLE public.user_profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  email TEXT NOT NULL UNIQUE,
  display_name TEXT,
  avatar_url TEXT,
  fitness_level TEXT DEFAULT 'beginner',
  birth_date DATE,
  gender TEXT,
  height_cm INTEGER,
  weight_kg NUMERIC(5, 2),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Index
CREATE INDEX idx_user_profiles_email ON public.user_profiles(email);

-- RLS (Row Level Security)
ALTER TABLE public.user_profiles ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own profile"
ON public.user_profiles FOR SELECT
USING (auth.uid() = id);

CREATE POLICY "Users can update own profile"
ON public.user_profiles FOR UPDATE
USING (auth.uid() = id);
```

#### 2. running_sessions í…Œì´ë¸”

```sql
CREATE TABLE public.running_sessions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES public.user_profiles(id) ON DELETE CASCADE,
  start_time TIMESTAMP WITH TIME ZONE NOT NULL,
  end_time TIMESTAMP WITH TIME ZONE NOT NULL,
  total_distance NUMERIC(10, 2) NOT NULL,  -- meters
  total_duration INTEGER NOT NULL,          -- seconds
  average_pace NUMERIC(5, 2),               -- min/km
  max_speed NUMERIC(5, 2),                  -- km/h
  average_heart_rate INTEGER,
  max_heart_rate INTEGER,
  calories_burned INTEGER,
  elevation_gain NUMERIC(8, 2),             -- meters
  elevation_loss NUMERIC(8, 2),             -- meters
  type TEXT DEFAULT 'free',                 -- free, interval, goal
  gps_points JSONB,                         -- GPS ë°ì´í„° ë°°ì—´
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Index
CREATE INDEX idx_running_sessions_user_id ON public.running_sessions(user_id);
CREATE INDEX idx_running_sessions_start_time ON public.running_sessions(start_time DESC);

-- RLS
ALTER TABLE public.running_sessions ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own sessions"
ON public.running_sessions FOR SELECT
USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own sessions"
ON public.running_sessions FOR INSERT
WITH CHECK (auth.uid() = user_id);
```

#### 3. Trigger: ìë™ í”„ë¡œí•„ ìƒì„±

```sql
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.user_profiles (id, email, display_name, avatar_url, created_at, updated_at)
  VALUES (
    NEW.id,
    NEW.email,
    COALESCE(
      NEW.raw_user_meta_data->>'display_name',
      NEW.raw_user_meta_data->>'full_name',
      SPLIT_PART(NEW.email, '@', 1)
    ),
    NEW.raw_user_meta_data->>'avatar_url',
    NOW(),
    NOW()
  );
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();
```

### SQLite (ë¡œì»¬ ë°ì´í„°ë² ì´ìŠ¤)

```dart
// lib/services/database_service.dart
class DatabaseService {
  static Database? _database;

  Future<Database> get database async {
    if (_database != null) return _database!;
    _database = await _initDatabase();
    return _database!;
  }

  Future<Database> _initDatabase() async {
    final path = await getDatabasesPath();
    final dbPath = join(path, 'stride_note.db');

    return await openDatabase(
      dbPath,
      version: 1,
      onCreate: _onCreate,
    );
  }

  Future<void> _onCreate(Database db, int version) async {
    // running_sessions í…Œì´ë¸”
    await db.execute('''
      CREATE TABLE running_sessions (
        id TEXT PRIMARY KEY,
        user_id TEXT NOT NULL,
        start_time INTEGER NOT NULL,
        end_time INTEGER NOT NULL,
        total_distance REAL NOT NULL,
        total_duration INTEGER NOT NULL,
        gps_points TEXT,
        synced INTEGER DEFAULT 0
      )
    ''');

    // Index
    await db.execute('''
      CREATE INDEX idx_sessions_synced
      ON running_sessions(synced)
    ''');
  }
}
```

---

## ì˜ì¡´ì„± ì£¼ì…

### Providerë¥¼ í†µí•œ ì˜ì¡´ì„± ì£¼ì…

```dart
// main.dart
MultiProvider(
  providers: [
    // State Management
    ChangeNotifierProvider(create: (_) => AuthProvider()),

    // Services (Singleton)
    Provider(create: (_) => LocationService()),
    Provider(create: (_) => DatabaseService()),
    Provider(create: (_) => HealthService()),
  ],
  child: MaterialApp(...),
)

// í™”ë©´ì—ì„œ ì‚¬ìš©
class HomeScreen extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    // Providerì—ì„œ Service ì£¼ì…ë°›ê¸°
    final locationService = Provider.of<LocationService>(
      context,
      listen: false,
    );

    return Scaffold(...);
  }
}
```

**ì¥ì **:

- âœ… í…ŒìŠ¤íŠ¸ ìš©ì´ (Mock ì£¼ì… ê°€ëŠ¥)
- âœ… ì˜ì¡´ì„± ëª…í™•í™”
- âœ… ëŠìŠ¨í•œ ê²°í•©

---

## ì—ëŸ¬ ì²˜ë¦¬ ì „ëµ

### 1. Try-Catch íŒ¨í„´

```dart
// Service Layer
class AuthService {
  static Future<User?> signInWithEmail({
    required String email,
    required String password,
  }) async {
    try {
      final response = await _supabase.auth.signInWithPassword(
        email: email,
        password: password,
      );
      return response.user;
    } on AuthException catch (e) {
      // Supabase ì¸ì¦ ì˜¤ë¥˜
      throw Exception('ì¸ì¦ ì‹¤íŒ¨: ${e.message}');
    } on SocketException catch (e) {
      // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜
      throw Exception('ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”');
    } catch (e) {
      // ê¸°íƒ€ ì˜¤ë¥˜
      throw Exception('ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜: $e');
    }
  }
}

// Provider Layer
class AuthProvider extends ChangeNotifier {
  Future<void> signIn(String email, String password) async {
    try {
      _isLoading = true;
      _errorMessage = null;
      notifyListeners();

      final user = await AuthService.signInWithEmail(
        email: email,
        password: password,
      );

      _currentUser = user;
    } catch (e) {
      _errorMessage = e.toString();
      // UIì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ rethrow
      rethrow;
    } finally {
      _isLoading = false;
      notifyListeners();
    }
  }
}

// View Layer
class LoginScreen extends StatelessWidget {
  Future<void> _handleLogin() async {
    try {
      await authProvider.signIn(email, password);
      Navigator.of(context).pushReplacement(...);
    } catch (e) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text(e.toString())),
      );
    }
  }
}
```

### 2. Result íŒ¨í„´ (ê³„íš ì¤‘)

```dart
// ì„±ê³µ/ì‹¤íŒ¨ë¥¼ ëª…ì‹œì ìœ¼ë¡œ í‘œí˜„
class Result<T> {
  final T? data;
  final String? error;
  final bool isSuccess;

  Result.success(this.data) : error = null, isSuccess = true;
  Result.failure(this.error) : data = null, isSuccess = false;
}

// ì‚¬ìš©
Future<Result<User>> signIn(String email, String password) async {
  try {
    final user = await AuthService.signInWithEmail(...);
    return Result.success(user);
  } catch (e) {
    return Result.failure(e.toString());
  }
}
```

---

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬

```dart
// .env (Gitì— í¬í•¨ ì•ˆ ë¨)
SUPABASE_URL=https://...
SUPABASE_ANON_KEY=...

// app_config.dart
class AppConfig {
  static String get supabaseUrl =>
      dotenv.env['SUPABASE_URL'] ?? '';

  static String get supabaseAnonKey =>
      dotenv.env['SUPABASE_ANON_KEY'] ?? '';
}
```

### 2. Row Level Security (RLS)

```sql
-- ì‚¬ìš©ìëŠ” ìì‹ ì˜ ë°ì´í„°ë§Œ ì ‘ê·¼ ê°€ëŠ¥
CREATE POLICY "Users can view own profile"
ON public.user_profiles FOR SELECT
USING (auth.uid() = id);
```

### 3. API Key ë³´í˜¸

- âœ… .env íŒŒì¼ ì‚¬ìš©
- âœ… .gitignoreì— ì¶”ê°€
- âœ… í´ë¼ì´ì–¸íŠ¸ì— ë…¸ì¶œë˜ì§€ ì•Šë„ë¡ ì£¼ì˜

---

## ì„±ëŠ¥ ìµœì í™”

### 1. ìœ„ì ¯ ìµœì í™”

```dart
// const ìƒì„±ì ì‚¬ìš©
const Text('Hello');  // âœ… ì¬ìƒì„± ì•ˆ ë¨
Text('Hello');        // âŒ ë§¤ë²ˆ ì¬ìƒì„±

// Selectorë¡œ ë¦¬ë¹Œë“œ ìµœì†Œí™”
Selector<AuthProvider, String?>(
  selector: (_, provider) => provider.currentUser?.email,
  builder: (_, email, __) => Text(email ?? ''),
)
```

### 2. ì´ë¯¸ì§€ ìµœì í™”

```dart
// ìºì‹œëœ ë„¤íŠ¸ì›Œí¬ ì´ë¯¸ì§€
CachedNetworkImage(
  imageUrl: avatarUrl,
  placeholder: (_, __) => CircularProgressIndicator(),
  errorWidget: (_, __, ___) => Icon(Icons.error),
)
```

### 3. ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”

```sql
-- Index ì¶”ê°€
CREATE INDEX idx_sessions_user_start
ON running_sessions(user_id, start_time DESC);

-- ì¿¼ë¦¬ ìµœì í™”
SELECT * FROM running_sessions
WHERE user_id = $1
ORDER BY start_time DESC
LIMIT 10;
```

---

## ì°¸ê³  ìë£Œ

- [Flutter ê³µì‹ ë¬¸ì„œ](https://flutter.dev/docs)
- [Provider íŒ¨í‚¤ì§€](https://pub.dev/packages/provider)
- [Supabase ë¬¸ì„œ](https://supabase.com/docs)
- [Clean Architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)

