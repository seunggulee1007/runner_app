# 실시간 지도 경로 추적 기능

## 🗺️ 개요

러닝 화면에서 GPS 경로를 실시간으로 추적하고 시각화하는 기능이 구현되었습니다.

## ✨ 주요 기능

### 1. 전체 화면 지도 표시
- 지도가 배경으로 전체 화면에 표시됩니다
- 통계 정보는 반투명 카드로 지도 위에 오버레이됩니다

### 2. 실시간 경로 추적
- GPS 위치가 수집되면 자동으로 파란색 라인으로 경로가 그려집니다
- 경로는 실시간으로 업데이트되며, 지나온 길이 모두 표시됩니다

### 3. 자동 카메라 추적
- 러닝 중일 때 카메라가 자동으로 현재 위치를 따라갑니다
- 줌 레벨 17, 45도 기울기로 3D 효과를 제공합니다

### 4. 시각적 개선
- **경로 라인**: 6픽셀 두께, 파란색, 둥근 모서리
- **마커**: 시작점(초록), 현재 위치(빨강)
- **오버레이**: 반투명 배경의 통계 카드들

## 🎨 UI 구조

```
러닝 화면
├── 배경 지도 (전체 화면)
│   ├── GPS 경로 폴리라인
│   ├── 시작점 마커
│   └── 현재 위치 마커
│
├── 상단 타이머 오버레이 (120px)
│   └── 반투명 다크 배경
│
├── 중간 통계 오버레이
│   ├── 거리, 속도, 페이스
│   └── 심박수 정보
│
└── 하단 컨트롤 오버레이 (100px)
    └── 시작/일시정지/종료 버튼
```

## 📱 사용자 경험

### 러닝 시작 전
1. 지도가 기본 위치(서울 시청)에 표시됩니다
2. GPS 수신을 기다립니다

### 러닝 중
1. **시작** 버튼을 누르면 GPS 추적이 시작됩니다
2. 이동하면서 파란색 경로가 실시간으로 그려집니다
3. 카메라가 자동으로 현재 위치를 추적합니다
4. 통계 정보가 실시간으로 업데이트됩니다

### 일시정지
1. **일시정지** 버튼을 누르면 GPS 추적이 멈춥니다
2. 경로는 그대로 유지됩니다
3. **재개** 버튼으로 다시 시작할 수 있습니다

### 러닝 종료
1. **종료** 버튼을 누르면 세션이 저장됩니다
2. 경로 데이터가 데이터베이스에 저장됩니다

## 🔧 기술 구현

### GPS 경로 수집
```dart
// LocationService에서 GPS 포인트 수집
_locationService.gpsPointsStream.listen((points) {
  if (mounted) {
    setState(() {
      _gpsPoints = points;
      _updateRunningStats();
    });
  }
});
```

### 폴리라인 렌더링
```dart
Polyline(
  polylineId: const PolylineId('running_route'),
  points: gpsPoints.map((point) => LatLng(point.latitude, point.longitude)).toList(),
  color: AppColors.primaryBlue,
  width: 6,
  geodesic: true,
  jointType: JointType.round,
  endCap: Cap.roundCap,
  startCap: Cap.roundCap,
)
```

### 자동 카메라 추적
```dart
void _moveToCurrentPosition() {
  _mapController.animateCamera(
    CameraUpdate.newCameraPosition(
      CameraPosition(
        target: currentLatLng,
        zoom: 17.0,
        tilt: 45.0,
        bearing: 0.0,
      ),
    ),
  );
}
```

## 🎯 Google Maps API 키 없이도 작동

### 플레이스홀더 UI
API 키가 없을 때도 다음 정보를 제공합니다:
- 실시간 GPS 포인트 수
- 시작점 좌표
- 현재 위치 좌표
- 러닝 상태 (러닝 중/일시정지)

### API 키 설정 후
- 실제 Google Maps가 표시됩니다
- 도로, 건물 등 상세한 지도 정보를 확인할 수 있습니다

## 📊 성능 최적화

### 1. 효율적인 경로 업데이트
- GPS 포인트가 추가될 때만 폴리라인 업데이트
- 불필요한 리렌더링 방지

### 2. 카메라 애니메이션
- 부드러운 카메라 이동으로 사용자 경험 개선
- 러닝 중일 때만 자동 추적

### 3. 메모리 관리
- 지도 컨트롤러 적절히 dispose
- 타이머와 스트림 구독 해제

## 🐛 알려진 제한사항

### 1. GPS 정확도
- 실내나 터널에서는 GPS 신호가 약할 수 있습니다
- 고층 건물 사이에서는 정확도가 떨어질 수 있습니다

### 2. 배터리 소모
- GPS와 지도 렌더링으로 배터리 소모가 증가할 수 있습니다
- 백그라운드 모드에서는 GPS 추적이 제한될 수 있습니다

## 🔮 향후 개선 계획

1. **경로 최적화**: GPS 노이즈 필터링
2. **오프라인 지도**: 캐시된 지도 타일 사용
3. **경로 재생**: 저장된 경로를 다시 볼 수 있는 기능
4. **경로 공유**: SNS로 경로 이미지 공유
5. **히트맵**: 자주 달리는 경로 시각화

## 📝 변경 이력

### 2025-10-17
- ✅ 지도 항상 표시 기능 추가
- ✅ 실시간 경로 추적 구현
- ✅ 자동 카메라 추적 기능
- ✅ 오버레이 UI 개선
- ✅ 플레이스홀더 UI 대폭 개선
